<topnav></topnav>
<loading *ngIf="!isReady"></loading>

<div class="container-fluid">
  <div class="row">
    <div class="col-xl-3 border-bottom">
      <div class="row border-bottom">
        <h3 class="btn-sm my-1 text-color">Rankings</h3>
      </div>
      <div
        class="list-group list-group-flush scrollarea"
        style="height: 90vh; overflow-y: scroll"
      >
        <div
          *ngFor="let item of rankings"
          class="list-group-item list-group-item-action py-3 lh-tight"
        >
          <div
            class="d-flex w-100 align-items-center justify-content-between"
            (click)="rankingData(item.id, item.name)"
          >
            <div class="flex-shrink-0">
              <img
                [src]="atobImg(item.logo)"
                class="rounded-circle img-ranking"
                height="40"
                width="40"
              />
            </div>
            <span class="text-muted">{{ item.role }}</span>
          </div>
          <div class="d-flex mt-2">
            <div class="flex-grow-1 fw-bolder">
              {{ item.name }}
            </div>
          </div>
          <div
            class="col-10 my-1 small"
            style="max-width: 350px; word-break: break-all"
          >
            {{ item.description }}
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-9">
      <div class="row gap-1 border-bottom">
        <div class="col-auto ms-1 ps-0">
          <h3 class="btn-sm my-1 text-color">Opciones</h3>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            data-bs-toggle="modal"
            data-bs-target="#addRankingModal"
            *ngIf="!nullRankings"
          >
            Añadir
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            routerLink="/create"
            *ngIf="!nullRankings"
          >
            Crear
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && isModerator"
            data-bs-toggle="modal"
            data-bs-target="#addUsersModal"
          >
            Participantes
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && isModerator"
            data-bs-toggle="modal"
            data-bs-target="#renewJoinCodeRankingModal"
          >
            Codigo acceso
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && isModerator"
            data-bs-toggle="modal"
            data-bs-target="#documnetModal"
          >
            Documento
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && isModerator"
            data-bs-toggle="modal"
            data-bs-target="#deleteRankingModal"
          >
            Eliminar ranking
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && !isModerator"
            data-bs-toggle="modal"
            data-bs-target="#exitRankingModal"
          >
            Salir del ranking
          </button>
        </div>
        <div class="col-auto g-0 mt-1">
          <button
            class="btn btn-sm btn-color text-light"
            *ngIf="rankingSelect && !isModerator"
            data-bs-toggle="modal"
            data-bs-target="#puntosModal"
          >
            Puntos Insinia: {{ insiniaPoints }}
          </button>
        </div>
      </div>
      <div style="height: 89vh">
        <ag-grid-angular
          style="height: 96%; width: 50rem;"
          class="ag-theme-alpine ranking table-responsive"
          [columnDefs]="columnDefsSelect"
          [rowData]="rowData"
          id="dataTable"
          [defaultColDef]="defaultColDef"
          resizable="true"
          [animateRows]="true"
          (cellValueChanged)="onCellValueChanged($event)"
          (onGridSizeChanged)="onGridSizeChanged($event)"
          (rowEditingStarted)="onRowEditingStarted($event)"
          (gridReady)="onGridReady($event)"
          [overlayNoRowsTemplate]="'No hay participantes'"
          [@fadeIn]
        >
        </ag-grid-angular>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="addRankingModal"
  tabindex="-1"
  aria-labelledby="addRankingModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="addRankingModalLabel">Añadir codigo</h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <input
          type="text"
          id="addRegisterInput"
          placeholder="Codigo"
          name="addRegisterInput"
          #addRegisterInput
        />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          (click)="addRankingByCode(addRegisterInput.value)"
          data-bs-dismiss="modal"
        >
          Añadir
        </button>
      </div>
    </div>
  </div>
</div>

<chips *ngIf="idSelect" [idRanking]="idSelect"></chips>

<div
  class="modal fade"
  id="renewJoinCodeRankingModal"
  tabindex="-1"
  aria-labelledby="renewJoinCodeRankingModal"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="renewJoinCodeRankingModal">
          Este codigo sirve para unirse al ranking {{ nameSelect }}
        </h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h1>Codigo: {{ joinCode }}</h1>
        <h4>Si renuevas el codigo de accesso el anterior no sera valido</h4>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
        <button
          [disabled]="buttonDisabled"
          type="button"
          class="btn btn-sm btn-color text-light"
          (click)="renewJoinCode()"
        >
          Renovar
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="deleteRankingModal"
  tabindex="-1"
  aria-labelledby="deleteRankingModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="deleteRankingModalLabel">
          Eliminar ranking
        </h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h3>Estas seguro que quieres eliminar el Ranking {{ nameSelect }}</h3>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          No
        </button>
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          data-bs-target="#deleteRankingModal2"
          data-bs-toggle="modal"
        >
          Si
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="deleteRankingModal2"
  tabindex="-1"
  aria-labelledby="deleteRankingModalLabel2"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="deleteRankingModalLabel2">
          Eliminar ranking
        </h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h3>Eliminar el ranking {{ nameSelect }} es irreversible</h3>
        <br />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          (click)="deleteRanking()"
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODALS Participantes   -->
<div
  class="modal fade"
  id="exitRankingModal"
  tabindex="-1"
  aria-labelledby="exitRankingModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exitRankingModalLabel">
          Salir del ranking
        </h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h3>Estas seguro que quieres salir del Ranking {{ nameSelect }}</h3>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          No
        </button>
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          data-bs-target="#exitRankingModal2"
          data-bs-toggle="modal"
        >
          Si
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Segunda parte del modal anterior -->
<div
  class="modal fade"
  id="exitRankingModal2"
  tabindex="-1"
  aria-labelledby="exitRankingModalLabel2"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exitRankingModalLabel2">
          Salir del ranking
        </h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h3>Si sales del ranking {{ nameSelect }} perderas todos tus puntos</h3>
        <br />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          (click)="exitRanking()"
        >
          Salir
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="puntosModal"
  tabindex="-1"
  aria-labelledby="puntosModal"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="puntosModal">Puntos Insinia</h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h3>Tienes {{ insiniaPoints }} puntos Insinia</h3>
        <h3>
          Estos puntos sirven para valuar a los compañeros de ranking segun sus
          aptitudes
        </h3>
        <br />
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          (click)="exitRanking()"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="documnetModal"
  tabindex="-1"
  aria-labelledby="documnetModal"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="documnetModal">Documento del Ranking</h3>
        <input
          type="file"
          name="file"
          id="file"
          [files]="file"
          onchange="console.log(event.target.files)"
        />

        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <label class="text-color text-truncate mt-2"
          >Imagen
          <label class="form-control-img text-color text-center"
            >Documento</label
          >
          <small @fadeIn class="text-color"
            >Puedes seleccionar otra foto si quieres.</small
          >
          <input
            #rankingPicture
            name="rankingPicture"
            id="rankingPicture"
            type="file"
            accept="image/png, image/jpg, image/jpeg, image/svg"
            class="hide"
          />
        </label>

        <br />
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-sm btn-color text-light"
          data-bs-dismiss="modal"
          download="file"
          href="..\..\files\ciudades.txt"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
